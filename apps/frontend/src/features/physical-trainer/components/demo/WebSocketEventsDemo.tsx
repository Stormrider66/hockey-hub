'use client';\n\nimport React, { useState, useEffect } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Separator } from '@/components/ui/separator';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { useSessionBroadcast } from '../../hooks/useSessionBroadcast';\nimport { useBulkSessionManager } from '../../hooks/useBulkSessionManager';\nimport { mockEventSimulator } from '../../utils/mockWebSocketEvents';\nimport { \n  Activity, \n  Zap, \n  Target, \n  Users, \n  Play, \n  Pause, \n  Square, \n  AlertTriangle,\n  TrendingUp,\n  Timer,\n  Dumbbell,\n  Heart,\n  Shuffle,\n  Navigation\n} from 'lucide-react';\n\ninterface EventLog {\n  id: string;\n  type: string;\n  timestamp: Date;\n  data: any;\n  severity: 'info' | 'success' | 'warning' | 'error';\n}\n\nexport function WebSocketEventsDemo() {\n  const [eventLog, setEventLog] = useState<EventLog[]>([]);\n  const [isAutoPlaying, setIsAutoPlaying] = useState(false);\n  const [selectedEventTypes, setSelectedEventTypes] = useState<string[]>(['all']);\n  \n  const sessionBroadcast = useSessionBroadcast({\n    enabled: true,\n    onConnectionChange: (connected) => {\n      addToLog({\n        type: 'CONNECTION',\n        data: { status: connected ? 'Connected' : 'Disconnected' },\n        severity: connected ? 'success' : 'error'\n      });\n    }\n  });\n  \n  const bulkManager = useBulkSessionManager({\n    enabled: true,\n    onBundleUpdate: (bundle) => {\n      addToLog({\n        type: 'BULK_UPDATE',\n        data: { bundleName: bundle.name, status: bundle.status, participants: bundle.totalParticipants },\n        severity: 'info'\n      });\n    },\n    onOperationComplete: (result) => {\n      addToLog({\n        type: 'BULK_OPERATION',\n        data: result,\n        severity: result.success ? 'success' : 'error'\n      });\n    },\n    onParticipantMove: (moveEvent) => {\n      addToLog({\n        type: 'PARTICIPANT_MOVE',\n        data: {\n          player: moveEvent.playerName,\n          from: moveEvent.fromSession.workoutType,\n          to: moveEvent.toSession.workoutType,\n          reason: moveEvent.moveReason\n        },\n        severity: 'warning'\n      });\n    }\n  });\n  \n  const addToLog = (event: Omit<EventLog, 'id' | 'timestamp'>) => {\n    const logEntry: EventLog = {\n      ...event,\n      id: `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n      timestamp: new Date()\n    };\n    \n    setEventLog(prev => [logEntry, ...prev.slice(0, 49)]); // Keep last 50 events\n  };\n  \n  const clearLog = () => setEventLog([]);\n  \n  const toggleAutoPlay = () => {\n    setIsAutoPlaying(!isAutoPlaying);\n    if (!isAutoPlaying) {\n      mockEventSimulator.startComprehensiveDemo();\n    } else {\n      mockEventSimulator.stop();\n    }\n  };\n  \n  const triggerEvent = (eventType: string) => {\n    switch (eventType) {\n      case 'strength':\n        mockEventSimulator.triggerStrengthSet();\n        addToLog({\n          type: 'MANUAL_TRIGGER',\n          data: { eventType: 'Strength Set Completion' },\n          severity: 'info'\n        });\n        break;\n      case 'conditioning':\n        mockEventSimulator.triggerConditioningTransition();\n        addToLog({\n          type: 'MANUAL_TRIGGER',\n          data: { eventType: 'Conditioning Interval Transition' },\n          severity: 'info'\n        });\n        break;\n      case 'hybrid':\n        mockEventSimulator.triggerHybridBlock();\n        addToLog({\n          type: 'MANUAL_TRIGGER',\n          data: { eventType: 'Hybrid Block Transition' },\n          severity: 'info'\n        });\n        break;\n      case 'agility':\n        mockEventSimulator.triggerAgilityDrill();\n        addToLog({\n          type: 'MANUAL_TRIGGER',\n          data: { eventType: 'Agility Drill Completion' },\n          severity: 'info'\n        });\n        break;\n      case 'bulk_start':\n        mockEventSimulator.triggerBulkSessionOperation('test-bundle', 'start_all');\n        addToLog({\n          type: 'MANUAL_TRIGGER',\n          data: { eventType: 'Bulk Start All Sessions' },\n          severity: 'info'\n        });\n        break;\n    }\n  };\n  \n  const getSeverityColor = (severity: EventLog['severity']) => {\n    switch (severity) {\n      case 'success': return 'bg-green-100 text-green-800 border-green-200';\n      case 'warning': return 'bg-yellow-100 text-yellow-800 border-yellow-200';\n      case 'error': return 'bg-red-100 text-red-800 border-red-200';\n      default: return 'bg-blue-100 text-blue-800 border-blue-200';\n    }\n  };\n  \n  const getEventIcon = (type: string) => {\n    switch (type.toLowerCase()) {\n      case 'strength':\n      case 'manual_trigger':\n        if (type.includes('Strength')) return <Dumbbell className=\"h-4 w-4\" />;\n        return <Activity className=\"h-4 w-4\" />;\n      case 'conditioning':\n        return <Heart className=\"h-4 w-4\" />;\n      case 'hybrid':\n        return <Shuffle className=\"h-4 w-4\" />;\n      case 'agility':\n        return <Navigation className=\"h-4 w-4\" />;\n      case 'bulk_update':\n      case 'bulk_operation':\n        return <Users className=\"h-4 w-4\" />;\n      case 'participant_move':\n        return <Target className=\"h-4 w-4\" />;\n      case 'connection':\n        return <Zap className=\"h-4 w-4\" />;\n      default:\n        return <Activity className=\"h-4 w-4\" />;\n    }\n  };\n  \n  const filteredEvents = eventLog.filter(event => \n    selectedEventTypes.includes('all') || \n    selectedEventTypes.some(type => event.type.toLowerCase().includes(type.toLowerCase()))\n  );\n  \n  const eventTypes = [\n    { id: 'all', label: 'All Events', icon: <Activity className=\"h-4 w-4\" /> },\n    { id: 'strength', label: 'Strength', icon: <Dumbbell className=\"h-4 w-4\" /> },\n    { id: 'conditioning', label: 'Conditioning', icon: <Heart className=\"h-4 w-4\" /> },\n    { id: 'hybrid', label: 'Hybrid', icon: <Shuffle className=\"h-4 w-4\" /> },\n    { id: 'agility', label: 'Agility', icon: <Navigation className=\"h-4 w-4\" /> },\n    { id: 'bulk', label: 'Bulk Ops', icon: <Users className=\"h-4 w-4\" /> },\n  ];\n  \n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h2 className=\"text-2xl font-bold\">WebSocket Events Demo</h2>\n          <p className=\"text-muted-foreground\">\n            Real-time demonstration of all workout types and bulk session WebSocket events\n          </p>\n        </div>\n        \n        <div className=\"flex items-center gap-2\">\n          <Badge variant={sessionBroadcast.isConnected ? 'default' : 'destructive'}>\n            {sessionBroadcast.isConnected ? 'Connected' : 'Disconnected'}\n          </Badge>\n          <Badge variant={bulkManager.isConnected ? 'default' : 'destructive'}>\n            Bulk: {bulkManager.isConnected ? 'Connected' : 'Disconnected'}\n          </Badge>\n        </div>\n      </div>\n      \n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n        {/* Controls */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Play className=\"h-5 w-5\" />\n              Demo Controls\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            {/* Auto Play */}\n            <div>\n              <Button \n                onClick={toggleAutoPlay}\n                variant={isAutoPlaying ? 'destructive' : 'default'}\n                className=\"w-full\"\n              >\n                {isAutoPlaying ? (\n                  <><Square className=\"h-4 w-4 mr-2\" />Stop Auto Demo</>\n                ) : (\n                  <><Play className=\"h-4 w-4 mr-2\" />Start Auto Demo</>\n                )}\n              </Button>\n              <p className=\"text-xs text-muted-foreground mt-1\">\n                {isAutoPlaying ? 'Random events every 15s' : 'Click to start continuous demo'}\n              </p>\n            </div>\n            \n            <Separator />\n            \n            {/* Manual Triggers */}\n            <div>\n              <h4 className=\"text-sm font-medium mb-2\">Manual Triggers</h4>\n              <div className=\"grid grid-cols-1 gap-2\">\n                <Button \n                  onClick={() => triggerEvent('strength')}\n                  variant=\"outline\" \n                  size=\"sm\"\n                  className=\"justify-start\"\n                >\n                  <Dumbbell className=\"h-4 w-4 mr-2\" />Strength Set\n                </Button>\n                <Button \n                  onClick={() => triggerEvent('conditioning')}\n                  variant=\"outline\" \n                  size=\"sm\"\n                  className=\"justify-start\"\n                >\n                  <Heart className=\"h-4 w-4 mr-2\" />Conditioning\n                </Button>\n                <Button \n                  onClick={() => triggerEvent('hybrid')}\n                  variant=\"outline\" \n                  size=\"sm\"\n                  className=\"justify-start\"\n                >\n                  <Shuffle className=\"h-4 w-4 mr-2\" />Hybrid Block\n                </Button>\n                <Button \n                  onClick={() => triggerEvent('agility')}\n                  variant=\"outline\" \n                  size=\"sm\"\n                  className=\"justify-start\"\n                >\n                  <Navigation className=\"h-4 w-4 mr-2\" />Agility Drill\n                </Button>\n                <Button \n                  onClick={() => triggerEvent('bulk_start')}\n                  variant=\"outline\" \n                  size=\"sm\"\n                  className=\"justify-start\"\n                >\n                  <Users className=\"h-4 w-4 mr-2\" />Bulk Operation\n                </Button>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n        \n        {/* Event Filters */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Target className=\"h-5 w-5\" />\n              Event Filters\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-2\">\n              {eventTypes.map(type => (\n                <Button\n                  key={type.id}\n                  onClick={() => {\n                    if (type.id === 'all') {\n                      setSelectedEventTypes(['all']);\n                    } else {\n                      setSelectedEventTypes(prev => {\n                        const filtered = prev.filter(t => t !== 'all');\n                        return prev.includes(type.id) \n                          ? filtered.filter(t => t !== type.id)\n                          : [...filtered, type.id];\n                      });\n                    }\n                  }}\n                  variant={selectedEventTypes.includes(type.id) || selectedEventTypes.includes('all') ? 'default' : 'outline'}\n                  size=\"sm\"\n                  className=\"w-full justify-start\"\n                >\n                  {type.icon}\n                  <span className=\"ml-2\">{type.label}</span>\n                  {selectedEventTypes.includes(type.id) && type.id !== 'all' && (\n                    <Badge variant=\"secondary\" className=\"ml-auto\">\n                      Active\n                    </Badge>\n                  )}\n                </Button>\n              ))}\n            </div>\n            \n            <Separator className=\"my-4\" />\n            \n            <div className=\"flex gap-2\">\n              <Button onClick={clearLog} variant=\"outline\" size=\"sm\" className=\"flex-1\">\n                Clear Log\n              </Button>\n              <Badge variant=\"outline\">\n                {filteredEvents.length} events\n              </Badge>\n            </div>\n          </CardContent>\n        </Card>\n        \n        {/* Statistics */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <TrendingUp className=\"h-5 w-5\" />\n              Statistics\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-3\">\n              <div className=\"flex justify-between items-center\">\n                <span className=\"text-sm text-muted-foreground\">Total Events</span>\n                <Badge variant=\"outline\">{eventLog.length}</Badge>\n              </div>\n              \n              <div className=\"flex justify-between items-center\">\n                <span className=\"text-sm text-muted-foreground\">Success Rate</span>\n                <Badge variant=\"default\">\n                  {eventLog.length > 0 \n                    ? Math.round((eventLog.filter(e => e.severity === 'success').length / eventLog.length) * 100)\n                    : 0}%\n                </Badge>\n              </div>\n              \n              <div className=\"flex justify-between items-center\">\n                <span className=\"text-sm text-muted-foreground\">Active Bundles</span>\n                <Badge variant=\"secondary\">{bulkManager.activeBundles.length}</Badge>\n              </div>\n              \n              <div className=\"flex justify-between items-center\">\n                <span className=\"text-sm text-muted-foreground\">Queued Updates</span>\n                <Badge variant={sessionBroadcast.queuedUpdates > 0 ? 'destructive' : 'outline'}>\n                  {sessionBroadcast.queuedUpdates}\n                </Badge>\n              </div>\n              \n              {bulkManager.currentOperation && (\n                <div className=\"p-3 border rounded-lg bg-blue-50\">\n                  <div className=\"flex items-center gap-2 mb-1\">\n                    <Timer className=\"h-4 w-4\" />\n                    <span className=\"text-sm font-medium\">Current Operation</span>\n                  </div>\n                  <p className=\"text-sm text-muted-foreground\">\n                    {bulkManager.currentOperation.type}\n                  </p>\n                  <div className=\"mt-2\">\n                    <div className=\"flex justify-between text-xs mb-1\">\n                      <span>Progress</span>\n                      <span>{Math.round(bulkManager.currentOperation.progress)}%</span>\n                    </div>\n                    <div className=\"w-full bg-gray-200 rounded-full h-2\">\n                      <div \n                        className=\"bg-blue-600 h-2 rounded-full transition-all duration-300\"\n                        style={{ width: `${bulkManager.currentOperation.progress}%` }}\n                      />\n                    </div>\n                  </div>\n                </div>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n      \n      {/* Event Log */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Activity className=\"h-5 w-5\" />\n            Live Event Log\n            <Badge variant=\"outline\" className=\"ml-auto\">\n              {filteredEvents.length} / {eventLog.length}\n            </Badge>\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <ScrollArea className=\"h-96\">\n            {filteredEvents.length === 0 ? (\n              <div className=\"text-center text-muted-foreground py-8\">\n                <Activity className=\"h-12 w-12 mx-auto mb-2 opacity-50\" />\n                <p>No events to display</p>\n                <p className=\"text-sm\">Start the demo or trigger events manually</p>\n              </div>\n            ) : (\n              <div className=\"space-y-2\">\n                {filteredEvents.map(event => (\n                  <div \n                    key={event.id}\n                    className={`p-3 rounded-lg border transition-all ${getSeverityColor(event.severity)}`}\n                  >\n                    <div className=\"flex items-start gap-3\">\n                      {getEventIcon(event.type)}\n                      <div className=\"flex-1 min-w-0\">\n                        <div className=\"flex items-center gap-2 mb-1\">\n                          <span className=\"font-medium text-sm\">{event.type.replace('_', ' ')}</span>\n                          <Badge variant=\"outline\" className=\"text-xs\">\n                            {event.timestamp.toLocaleTimeString()}\n                          </Badge>\n                        </div>\n                        \n                        <div className=\"text-sm opacity-75\">\n                          <pre className=\"whitespace-pre-wrap font-mono text-xs bg-white bg-opacity-50 p-2 rounded\">\n                            {JSON.stringify(event.data, null, 2)}\n                          </pre>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n          </ScrollArea>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}