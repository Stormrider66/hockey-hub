"use strict";(self.webpackChunkhockey_hub_frontend=self.webpackChunkhockey_hub_frontend||[]).push([[258],{"./src/components/TestAnalyticsPanel.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,Error:()=>Error,Loading:()=>Loading,__namedExportsOrder:()=>__namedExportsOrder,default:()=>TestAnalyticsPanel_stories});var react=__webpack_require__("../../node_modules/.pnpm/react@18.3.1/node_modules/react/index.js"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.3.1/node_modules/react/jsx-runtime.js"),dist=__webpack_require__("../../node_modules/.pnpm/@radix-ui+react-select@2.2._3233a9e0523559b1b760ae22c7a1bd5d/node_modules/@radix-ui/react-select/dist/index.mjs"),utils=__webpack_require__("./src/lib/utils.ts"),chart=__webpack_require__("../../node_modules/.pnpm/chart.js@4.4.9/node_modules/chart.js/dist/chart.js");function reforwardRef(ref,value){"function"==typeof ref?ref(value):ref&&(ref.current=value)}function setLabels(currentData,nextLabels){currentData.labels=nextLabels}function setDatasets(currentData,nextDatasets){let datasetIdKey=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"label";const addedDatasets=[];currentData.datasets=nextDatasets.map((nextDataset=>{const currentDataset=currentData.datasets.find((dataset=>dataset[datasetIdKey]===nextDataset[datasetIdKey]));return currentDataset&&nextDataset.data&&!addedDatasets.includes(currentDataset)?(addedDatasets.push(currentDataset),Object.assign(currentDataset,nextDataset),currentDataset):{...nextDataset}}))}function cloneData(data){let datasetIdKey=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"label";const nextData={labels:[],datasets:[]};return setLabels(nextData,data.labels),setDatasets(nextData,data.datasets,datasetIdKey),nextData}function ChartComponent(props,ref){const{height=150,width=300,redraw=!1,datasetIdKey,type,data,options,plugins=[],fallbackContent,updateMode,...canvasProps}=props,canvasRef=(0,react.useRef)(null),chartRef=(0,react.useRef)(null),renderChart=()=>{canvasRef.current&&(chartRef.current=new chart.t1(canvasRef.current,{type,data:cloneData(data,datasetIdKey),options:options&&{...options},plugins}),reforwardRef(ref,chartRef.current))},destroyChart=()=>{reforwardRef(ref,null),chartRef.current&&(chartRef.current.destroy(),chartRef.current=null)};return(0,react.useEffect)((()=>{!redraw&&chartRef.current&&options&&function setOptions(chart,nextOptions){const options=chart.options;options&&nextOptions&&Object.assign(options,nextOptions)}(chartRef.current,options)}),[redraw,options]),(0,react.useEffect)((()=>{!redraw&&chartRef.current&&setLabels(chartRef.current.config.data,data.labels)}),[redraw,data.labels]),(0,react.useEffect)((()=>{!redraw&&chartRef.current&&data.datasets&&setDatasets(chartRef.current.config.data,data.datasets,datasetIdKey)}),[redraw,data.datasets]),(0,react.useEffect)((()=>{chartRef.current&&(redraw?(destroyChart(),setTimeout(renderChart)):chartRef.current.update(updateMode))}),[redraw,options,data.labels,data.datasets,updateMode]),(0,react.useEffect)((()=>{chartRef.current&&(destroyChart(),setTimeout(renderChart))}),[type]),(0,react.useEffect)((()=>(renderChart(),()=>destroyChart())),[]),react.createElement("canvas",{ref:canvasRef,role:"img",height,width,...canvasProps},fallbackContent)}const Chart=(0,react.forwardRef)(ChartComponent);function createTypedChart(type,registerables){return chart.t1.register(registerables),(0,react.forwardRef)(((props,ref)=>react.createElement(Chart,{...props,ref,type})))}const Line=createTypedChart("line",chart.ZT);const testAnalyticsApi=__webpack_require__("./src/store/api/apiSlice.ts").lh.injectEndpoints({endpoints:builder=>({getTestDefinitions:builder.query({query:()=>"/tests"}),getCorrelation:builder.query({query:({testX,testY,playerId})=>`/tests/analytics/correlation?testX=${testX}&testY=${testY}&playerId=${playerId}`}),postRegression:builder.mutation({query:body=>({url:"/tests/analytics/regression",method:"POST",body})})})}),{useGetTestDefinitionsQuery,useGetCorrelationQuery,useLazyGetCorrelationQuery,usePostRegressionMutation}=testAnalyticsApi;function TestAnalyticsPanel({playerId}){const{data:definitions=[],isLoading:defLoading,isError:defError}=useGetTestDefinitionsQuery(),[triggerCorrelation,{data:corrData,isLoading:corrLoading,isError:corrError}]=useLazyGetCorrelationQuery(),[postRegression,{data:regData,isLoading:regLoading,isError:regError}]=usePostRegressionMutation(),[testX,setTestX]=(0,react.useState)(""),[testY,setTestY]=(0,react.useState)(""),[targetTest,setTargetTest]=(0,react.useState)(""),[predictors,setPredictors]=(0,react.useState)([]);return(0,jsx_runtime.jsxs)("div",{className:"space-y-8",children:[(0,jsx_runtime.jsxs)("section",{className:"p-4 bg-white rounded-lg shadow space-y-4",children:[(0,jsx_runtime.jsx)("h2",{className:"text-lg font-medium",children:"Correlation Analysis"}),defLoading?(0,jsx_runtime.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,jsx_runtime.jsx)("div",{className:"border-4 border-gray-200 border-t-blue-500 rounded-full w-6 h-6 animate-spin"}),(0,jsx_runtime.jsx)("span",{children:"Loading tests..."})]}):defError?(0,jsx_runtime.jsx)("p",{className:"text-red-600",children:"Error loading test definitions."}):(0,jsx_runtime.jsxs)("div",{className:"flex flex-wrap gap-4",children:[(0,jsx_runtime.jsxs)(dist.bL,{onValueChange:setTestX,value:testX,children:[(0,jsx_runtime.jsx)(dist.l9,{children:(0,jsx_runtime.jsx)(dist.WT,{placeholder:"Select Test X"})}),(0,jsx_runtime.jsx)(dist.UC,{children:definitions.map((def=>(0,jsx_runtime.jsx)(dist.q7,{value:def.id,children:def.name},def.id)))})]}),(0,jsx_runtime.jsxs)(dist.bL,{onValueChange:setTestY,value:testY,children:[(0,jsx_runtime.jsx)(dist.l9,{children:(0,jsx_runtime.jsx)(dist.WT,{placeholder:"Select Test Y"})}),(0,jsx_runtime.jsx)(dist.UC,{children:definitions.map((def=>(0,jsx_runtime.jsx)(dist.q7,{value:def.id,children:def.name},def.id)))})]}),(0,jsx_runtime.jsx)("button",{className:(0,utils.cn)("px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",corrLoading&&"opacity-50 cursor-not-allowed"),onClick:()=>{testX&&testY&&triggerCorrelation({testX,testY,playerId})},disabled:corrLoading,children:"Compute Correlation"})]}),corrLoading&&(0,jsx_runtime.jsx)("p",{children:"Computing correlation..."}),corrError&&(0,jsx_runtime.jsx)("p",{className:"text-red-600",children:"Error computing correlation."}),corrData&&(0,jsx_runtime.jsxs)("div",{className:"space-y-2",children:[(0,jsx_runtime.jsxs)("p",{children:["Pearson's r: ",corrData.r.toFixed(3)]}),(0,jsx_runtime.jsx)("div",{className:"h-64",children:(0,jsx_runtime.jsx)(Line,{data:{datasets:[{label:"Scatter",data:corrData.scatter,backgroundColor:"rgba(59, 130, 246, 0.7)"}]},options:{scales:{x:{type:"linear",position:"bottom"}}}})})]})]}),(0,jsx_runtime.jsxs)("section",{className:"p-4 bg-white rounded-lg shadow space-y-4",children:[(0,jsx_runtime.jsx)("h2",{className:"text-lg font-medium",children:"Regression Analysis (Single Predictor)"}),defLoading?(0,jsx_runtime.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,jsx_runtime.jsx)("div",{className:"border-4 border-gray-200 border-t-green-500 rounded-full w-6 h-6 animate-spin"}),(0,jsx_runtime.jsx)("span",{children:"Loading tests..."})]}):defError?(0,jsx_runtime.jsx)("p",{className:"text-red-600",children:"Error loading test definitions."}):(0,jsx_runtime.jsxs)("div",{className:"flex flex-wrap gap-4",children:[(0,jsx_runtime.jsxs)(dist.bL,{onValueChange:setTargetTest,value:targetTest,children:[(0,jsx_runtime.jsx)(dist.l9,{children:(0,jsx_runtime.jsx)(dist.WT,{placeholder:"Select Target Test"})}),(0,jsx_runtime.jsx)(dist.UC,{children:definitions.map((def=>(0,jsx_runtime.jsx)(dist.q7,{value:def.id,children:def.name},def.id)))})]}),(0,jsx_runtime.jsxs)(dist.bL,{onValueChange:value=>setPredictors([value]),value:predictors[0]||"",children:[(0,jsx_runtime.jsx)(dist.l9,{children:(0,jsx_runtime.jsx)(dist.WT,{placeholder:"Select Predictor Test"})}),(0,jsx_runtime.jsx)(dist.UC,{children:definitions.map((def=>(0,jsx_runtime.jsx)(dist.q7,{value:def.id,children:def.name},def.id)))})]}),(0,jsx_runtime.jsx)("button",{className:(0,utils.cn)("px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700",regLoading&&"opacity-50 cursor-not-allowed"),onClick:()=>{targetTest&&predictors.length>0&&postRegression({targetTest,predictors,playerId})},disabled:regLoading,children:"Compute Regression"})]}),regLoading&&(0,jsx_runtime.jsx)("p",{children:"Computing regression..."}),regError&&(0,jsx_runtime.jsx)("p",{className:"text-red-600",children:"Error computing regression."}),regData&&(0,jsx_runtime.jsxs)("div",{className:"space-y-1",children:[(0,jsx_runtime.jsxs)("p",{children:["Intercept: ",regData.coefficients[0].toFixed(3)]}),(0,jsx_runtime.jsxs)("p",{children:["Slope: ",regData.coefficients[1].toFixed(3)]}),(0,jsx_runtime.jsxs)("p",{children:["RÂ²: ",regData.r2.toFixed(3)]})]}),regData&&corrData&&(0,jsx_runtime.jsx)("div",{className:"h-64",children:(0,jsx_runtime.jsx)(Line,{data:{datasets:[{label:"Data",data:corrData.scatter,backgroundColor:"rgba(16,185,129,0.5)",pointRadius:4},{label:"Fit",type:"line",data:corrData.scatter.map((p=>({x:p.x,y:regData.coefficients[0]+regData.coefficients[1]*p.x}))),borderColor:"rgba(16,185,129,1)",borderWidth:2,fill:!1,pointRadius:0}]},options:{scales:{x:{type:"linear",position:"bottom"}}}})})]})]})}TestAnalyticsPanel.__docgenInfo={description:"",methods:[],displayName:"TestAnalyticsPanel",props:{playerId:{required:!0,tsType:{name:"string"},description:""}}};var http=__webpack_require__("../../node_modules/.pnpm/msw@2.8.2_@types+node@20.17.32_typescript@5.3.3/node_modules/msw/lib/core/http.mjs"),HttpResponse=__webpack_require__("../../node_modules/.pnpm/msw@2.8.2_@types+node@20.17.32_typescript@5.3.3/node_modules/msw/lib/core/HttpResponse.mjs");const TestAnalyticsPanel_stories={title:"Components/TestAnalyticsPanel",component:TestAnalyticsPanel,parameters:{layout:"centered"}},Default={args:{playerId:"player-123"}},Loading={parameters:{msw:{handlers:[http.L.get("/tests",(async()=>new Promise((()=>{}))))]}},args:{playerId:"player-123"}},Error={parameters:{msw:{handlers:[http.L.get("/tests",(async()=>new HttpResponse.c(null,{status:500})))]}},args:{playerId:"player-123"}},__namedExportsOrder=["Default","Loading","Error"];Default.parameters={...Default.parameters,docs:{...Default.parameters?.docs,source:{originalSource:"{\n  args: {\n    playerId: 'player-123'\n  }\n}",...Default.parameters?.docs?.source}}},Loading.parameters={...Loading.parameters,docs:{...Loading.parameters?.docs,source:{originalSource:"{\n  parameters: {\n    msw: {\n      handlers: [\n      // Delay definitions to simulate loading\n      http.get('/tests', async () => {\n        return new Promise(() => {}); // Never resolve\n      })]\n    }\n  },\n  args: {\n    playerId: 'player-123'\n  }\n}",...Loading.parameters?.docs?.source}}},Error.parameters={...Error.parameters,docs:{...Error.parameters?.docs,source:{originalSource:"{\n  parameters: {\n    msw: {\n      handlers: [\n      // Return 500 for definitions to simulate error\n      http.get('/tests', async () => {\n        return new HttpResponse(null, {\n          status: 500\n        });\n      })]\n    }\n  },\n  args: {\n    playerId: 'player-123'\n  }\n}",...Error.parameters?.docs?.source}}}},"./src/lib/utils.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{cn:()=>cn});var clsx__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/clsx@2.1.1/node_modules/clsx/dist/clsx.mjs"),tailwind_merge__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/tailwind-merge@1.14.0/node_modules/tailwind-merge/dist/lib/tw-merge.mjs");function cn(...inputs){return(0,tailwind_merge__WEBPACK_IMPORTED_MODULE_0__.Q)((0,clsx__WEBPACK_IMPORTED_MODULE_1__.$)(inputs))}}}]);